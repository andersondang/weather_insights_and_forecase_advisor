# üèóÔ∏è System Architecture - High Resolution

**Weather Insights and Forecast Advisor - Multi-Agent System**

---

## Complete System Architecture

```mermaid
%%{init: {'theme':'base', 'themeVariables': { 'fontSize':'20px', 'fontFamily':'arial'}}}%%
graph TB
    subgraph Frontend["üåê FRONTEND - React Application"]
        direction TB
        Dashboard["üìä Dashboard Page<br/><br/>‚Ä¢ Active Weather Alerts<br/>‚Ä¢ Interactive Map<br/>‚Ä¢ Severity Filtering<br/>‚Ä¢ Auto-refresh"]
        Chat["üí¨ Chat Page<br/><br/>‚Ä¢ Natural Language Queries<br/>‚Ä¢ Conversation History<br/>‚Ä¢ Multi-turn Context<br/>‚Ä¢ All Agent Access"]
        Forecast["üå§Ô∏è Forecast Page<br/><br/>‚Ä¢ 7-Day Forecast<br/>‚Ä¢ Hourly Predictions<br/>‚Ä¢ Location Search<br/>‚Ä¢ Weather Details"]
        Emergency["üè• Emergency Resources<br/><br/>‚Ä¢ Shelter Finder<br/>‚Ä¢ Hospital Locator<br/>‚Ä¢ Pharmacy Search<br/>‚Ä¢ Route Planning"]
        Hurricane["üåÄ Hurricane Simulation<br/><br/>‚Ä¢ Image Upload<br/>‚Ä¢ Category Detection<br/>‚Ä¢ Evacuation Priorities<br/>‚Ä¢ Risk Mapping"]
        
        APIService["üîå API Service Layer<br/><br/>‚Ä¢ Axios HTTP Client<br/>‚Ä¢ Session Management<br/>‚Ä¢ Error Handling<br/>‚Ä¢ Response Caching"]
        
        Dashboard --> APIService
        Chat --> APIService
        Forecast --> APIService
        Emergency --> APIService
        Hurricane --> APIService
    end
    
    subgraph Backend["‚öôÔ∏è BACKEND - Multi-Agent System (Google ADK)"]
        direction TB
        
        subgraph AlertsAgent["üö® ALERTS SNAPSHOT AGENT<br/>Port: 8081<br/>Model: gemini-2.5-flash"]
            direction LR
            AlertsRetriever["alerts_retriever_agent<br/><br/>‚Ä¢ Fetch NWS alerts<br/>‚Ä¢ Filter by severity<br/>‚Ä¢ Limit to top 5<br/>‚Ä¢ Extract zone IDs"]
            AlertsCoordinator["alerts_coordinator_agent<br/><br/>‚Ä¢ Get zone coordinates<br/>‚Ä¢ Create map markers<br/>‚Ä¢ Synthesize response<br/>‚Ä¢ Format AlertsSnapshot"]
            AlertsRetriever --> AlertsCoordinator
        end
        
        ForecastAgent["üå§Ô∏è FORECAST AGENT<br/>Port: 8082<br/>Model: gemini-2.5-flash<br/><br/>Tools:<br/>‚Ä¢ get_nws_forecast<br/>‚Ä¢ get_hourly_forecast<br/>‚Ä¢ geocode_address<br/><br/>Capabilities:<br/>‚Ä¢ 7-day forecasts<br/>‚Ä¢ 48-hour hourly<br/>‚Ä¢ Location geocoding<br/>‚Ä¢ Weather details"]
        
        RiskAgent["‚ö†Ô∏è RISK ANALYSIS AGENT<br/>Port: 8083<br/>Model: gemini-2.5-flash<br/><br/>Tools:<br/>‚Ä¢ get_census_demographics<br/>‚Ä¢ get_flood_risk_data<br/>‚Ä¢ get_nws_alerts<br/><br/>Capabilities:<br/>‚Ä¢ Vulnerability assessment<br/>‚Ä¢ Historical flood data<br/>‚Ä¢ Population analysis<br/>‚Ä¢ Risk scoring"]
        
        EmergencyAgent["üè• EMERGENCY RESOURCES AGENT<br/>Port: 8084<br/>Model: gemini-2.5-flash<br/><br/>Tools:<br/>‚Ä¢ geocode_address<br/>‚Ä¢ search_nearby_places<br/>‚Ä¢ generate_map<br/>‚Ä¢ get_directions<br/><br/>Capabilities:<br/>‚Ä¢ Find shelters/hospitals<br/>‚Ä¢ Route planning<br/>‚Ä¢ Interactive maps<br/>‚Ä¢ Distance calculation"]
        
        subgraph HurricaneAgent["üåÄ HURRICANE SIMULATION AGENT<br/>Port: 8085<br/>Model: gemini-2.5-flash"]
            direction LR
            ImageAnalysis["hurricane_image_analysis<br/><br/>‚Ä¢ Gemini Vision API<br/>‚Ä¢ Extract category<br/>‚Ä¢ Identify states<br/>‚Ä¢ Get bounding box"]
            EvacCoordinator["evacuation_coordinator<br/><br/>‚Ä¢ Query flood data<br/>‚Ä¢ Calculate risk scores<br/>‚Ä¢ Prioritize locations<br/>‚Ä¢ Generate plan"]
            ImageAnalysis --> EvacCoordinator
        end
        
        ChatAgent["üí¨ CHAT ORCHESTRATOR AGENT<br/>Port: 8090<br/>Model: gemini-2.5-flash<br/><br/>ALL TOOLS (16+ tools)<br/><br/>Routing:<br/>‚Ä¢ Alerts ‚Üí alerts_snapshot_workflow<br/>‚Ä¢ Forecast ‚Üí forecast_workflow<br/>‚Ä¢ Risk ‚Üí risk_analysis_workflow<br/>‚Ä¢ Resources ‚Üí emergency_resources_workflow<br/>‚Ä¢ Hurricane ‚Üí HurricaneSimulationAgent<br/><br/>Capabilities:<br/>‚Ä¢ Natural language understanding<br/>‚Ä¢ Intent classification<br/>‚Ä¢ Multi-turn conversations<br/>‚Ä¢ Context management"]
        
        subgraph SharedTools["üõ†Ô∏è SHARED TOOLS LIBRARY"]
            direction TB
            WeatherTools["‚òÅÔ∏è Weather Tools<br/><br/>‚Ä¢ get_nws_alerts<br/>‚Ä¢ get_nws_forecast<br/>‚Ä¢ get_hourly_forecast<br/>‚Ä¢ get_current_conditions<br/>‚Ä¢ get_hurricane_track<br/>‚Ä¢ get_zone_coordinates"]
            MapsTools["üó∫Ô∏è Maps Tools<br/><br/>‚Ä¢ geocode_address<br/>‚Ä¢ get_directions<br/>‚Ä¢ search_nearby_places<br/>‚Ä¢ generate_map<br/>‚Ä¢ reverse_geocode"]
            DataTools["üìä Data Tools<br/><br/>‚Ä¢ get_census_demographics<br/>‚Ä¢ get_flood_risk_data<br/>‚Ä¢ get_census_tracts_in_area<br/>‚Ä¢ find_nearest_weather_station<br/>‚Ä¢ calculate_evacuation_priority"]
        end
    end
    
    subgraph External["üåç EXTERNAL APIs & DATA SOURCES"]
        direction TB
        NWS["üå¶Ô∏è National Weather Service<br/><br/>‚Ä¢ api.weather.gov<br/>‚Ä¢ Active alerts<br/>‚Ä¢ Forecasts (7-day, hourly)<br/>‚Ä¢ Current conditions<br/>‚Ä¢ Zone data"]
        GoogleMaps["üó∫Ô∏è Google Maps Platform<br/><br/>‚Ä¢ Geocoding API<br/>‚Ä¢ Places API<br/>‚Ä¢ Directions API<br/>‚Ä¢ Maps Static API<br/>‚Ä¢ Distance Matrix"]
        BigQuery["üìä Google BigQuery<br/><br/>‚Ä¢ Census demographics<br/>‚Ä¢ Historical flood events<br/>‚Ä¢ Weather station data<br/>‚Ä¢ Census tract boundaries<br/>‚Ä¢ NOAA datasets"]
    end
    
    APIService -->|"HTTP POST<br/>JSON Payload"| AlertsAgent
    APIService -->|"HTTP POST<br/>JSON Payload"| ForecastAgent
    APIService -->|"HTTP POST<br/>JSON Payload"| RiskAgent
    APIService -->|"HTTP POST<br/>JSON Payload"| EmergencyAgent
    APIService -->|"HTTP POST<br/>Multipart Form"| HurricaneAgent
    APIService -->|"HTTP POST<br/>JSON Payload"| ChatAgent
    
    AlertsAgent --> WeatherTools
    ForecastAgent --> WeatherTools
    ForecastAgent --> MapsTools
    RiskAgent --> WeatherTools
    RiskAgent --> MapsTools
    RiskAgent --> DataTools
    EmergencyAgent --> MapsTools
    HurricaneAgent --> DataTools
    ChatAgent --> WeatherTools
    ChatAgent --> MapsTools
    ChatAgent --> DataTools
    
    WeatherTools -->|"REST API<br/>JSON Response"| NWS
    MapsTools -->|"REST API<br/>JSON Response"| GoogleMaps
    DataTools -->|"SQL Queries<br/>Table Results"| BigQuery
    
    style Frontend fill:#e3f2fd,stroke:#1976d2,stroke-width:4px,color:#000
    style Backend fill:#f3e5f5,stroke:#7b1fa2,stroke-width:4px,color:#000
    style External fill:#fff3e0,stroke:#f57c00,stroke-width:4px,color:#000
    style AlertsAgent fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000
    style HurricaneAgent fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000
    style SharedTools fill:#e8f5e9,stroke:#388e3c,stroke-width:3px,color:#000
    style ChatAgent fill:#fff9c4,stroke:#f57f17,stroke-width:3px,color:#000
```

---

## ü§ñ Agent Descriptions

### 1. üö® Alerts Snapshot Agent (Port 8081)

**Purpose:** Retrieve and synthesize active severe weather alerts

**Sub-Agents:**
- `alerts_retriever_agent` - Fetches alerts from NWS API, filters by severity
- `alerts_coordinator_agent` - Enriches with zone coordinates, creates map markers

**Key Tools:**
- `get_nws_alerts` - National/state/point-based alert retrieval
- `get_zone_coordinates` - Convert zone IDs to lat/lng boundaries

**Model:** gemini-2.5-flash

**Output Schema:** `AlertsSnapshot` (alerts array, map markers, summary)

---

### 2. üå§Ô∏è Forecast Agent (Port 8082)

**Purpose:** Provide detailed weather forecasts for any location

**Key Tools:**
- `get_nws_forecast` - 7-day forecast with day/night periods
- `get_hourly_forecast` - 48-hour hourly predictions
- `geocode_address` - Convert location names to coordinates

**Model:** gemini-2.5-flash

**Output Schema:** `ForecastData` (daily forecasts, hourly forecasts, location info)

**Features:**
- Automatic geocoding of location names
- Day/night period grouping
- Temperature, precipitation, wind details
- Weather icons and descriptions

---

### 3. ‚ö†Ô∏è Risk Analysis Agent (Port 8083)

**Purpose:** Assess vulnerability and disaster impact

**Key Tools:**
- `get_census_demographics` - Population, age, income data
- `get_flood_risk_data` - Historical flood events by location
- `get_nws_alerts` - Current weather threats

**Model:** gemini-2.5-flash

**Output Schema:** `RiskAnalysis` (risk score, vulnerable populations, recommendations)

**Capabilities:**
- Identify elderly populations (65+)
- Analyze low-income areas
- Historical flood correlation
- Evacuation priority scoring

---

### 4. üè• Emergency Resources Agent (Port 8084)

**Purpose:** Find emergency shelters, hospitals, and evacuation routes

**Key Tools:**
- `geocode_address` - Location to coordinates
- `search_nearby_places` - Find shelters, hospitals, pharmacies
- `generate_map` - Create interactive maps
- `get_directions` - Multi-route planning

**Model:** gemini-2.5-flash

**Output Schema:** `EmergencyResources` (shelters, hospitals, routes, map)

**Features:**
- Radius-based search (5-50 miles)
- Capacity and amenity information
- Multiple route alternatives
- Contact information and addresses

---

### 5. üåÄ Hurricane Simulation Agent (Port 8085)

**Purpose:** Analyze hurricane satellite images and calculate evacuation priorities

**Sub-Agents:**
- `hurricane_image_analysis_agent` - Gemini Vision for image analysis
- `evacuation_coordinator_agent` - Risk scoring and prioritization

**Key Tools:**
- `get_flood_risk_data` - Historical flood events
- `calculate_evacuation_priority` - Risk scoring algorithm

**Model:** gemini-2.5-flash (with Vision)

**Output Schema:** `EvacuationPlan` (prioritized locations, risk scores, insights)

**Process:**
1. Analyze hurricane image (category, affected states, bounding box)
2. Query flood risk data for each affected state
3. Calculate risk scores based on hurricane intensity + flood history
4. Prioritize top 20 high-risk locations
5. Generate evacuation plan with recommendations

---

### 6. üí¨ Chat Orchestrator Agent (Port 8090)

**Purpose:** Natural language interface with intelligent routing to all agents

**Routing Logic:**
- **Alerts** ‚Üí `alerts_snapshot_workflow`
- **Forecast** ‚Üí `forecast_workflow`
- **Risk Analysis** ‚Üí `risk_analysis_workflow`
- **Emergency Resources** ‚Üí `emergency_resources_workflow`
- **Hurricane Analysis** ‚Üí `HurricaneSimulationAgent`

**All Tools Available:** 16+ tools from all categories

**Model:** gemini-2.5-flash

**Features:**
- Multi-turn conversation support
- Intent classification
- Context management
- Automatic agent selection
- Unified response formatting

---

## üìä Data Flow Summary

```
User Request ‚Üí Frontend Page ‚Üí API Service ‚Üí Specific Agent ‚Üí Tools ‚Üí External APIs ‚Üí Response
                                                    ‚Üì
                                            Shared Tools Library
                                                    ‚Üì
                                    Weather Tools | Maps Tools | Data Tools
                                                    ‚Üì
                                        NWS | Google Maps | BigQuery
```

---

## üîß Technology Stack

| Layer | Technology | Purpose |
|-------|-----------|---------|
| **Frontend** | React 18 + Tailwind CSS | Modern, responsive UI |
| **Routing** | React Router v6 | Client-side navigation |
| **Maps** | Leaflet + OpenStreetMap | Interactive map visualization |
| **HTTP Client** | Axios | API communication |
| **Backend Framework** | Google ADK (Agent Development Kit) | Multi-agent orchestration |
| **LLM** | Gemini 2.5 Flash | All agents |
| **Vision** | Gemini 2.5 Flash (Vision) | Hurricane image analysis |
| **Deployment** | Cloud Run (Backend) + Firebase Hosting (Frontend) | Serverless, scalable |
| **APIs** | NWS, Google Maps, BigQuery | Real-time data sources |

---

## üöÄ Deployment Architecture

```
Frontend (Firebase Hosting)
    ‚Üì HTTPS
Backend (Cloud Run - 6 containers)
    ‚îú‚îÄ‚îÄ alerts-agent:8081
    ‚îú‚îÄ‚îÄ forecast-agent:8082
    ‚îú‚îÄ‚îÄ risk-agent:8083
    ‚îú‚îÄ‚îÄ emergency-agent:8084
    ‚îú‚îÄ‚îÄ hurricane-agent:8085
    ‚îî‚îÄ‚îÄ chat-agent:8090
    ‚Üì
External APIs
    ‚îú‚îÄ‚îÄ api.weather.gov
    ‚îú‚îÄ‚îÄ maps.googleapis.com
    ‚îî‚îÄ‚îÄ bigquery.googleapis.com
```

**Live URLs:**
- Frontend: https://weather-insights-forecaster.web.app
- Backend: https://weather-insights-agent-79797180773.us-central1.run.app

---

**Last Updated:** October 2025  
**Version:** 1.0  
**Built for:** Agents for Impact '25 - Climate & Public Safety
